#!/bin/bash

mkdir -pv certs

echo "Generating CA cert"
openssl req -x509 -noenc \
-newkey rsa:1024 \
-days 1000 \
-keyout certs/ca.key -out certs/ca.crt \
-subj "/C=FR/ST=ARA/L=Grenoble/O=Grenoble INP/OU=CA/CN=localhost/emailAddress=ca@local"

echo "Generating server csr"
openssl req -new -noenc \
-newkey rsa:1024 \
-keyout certs/srv.key -out certs/srv.csr \
-subj "/C=FR/ST=ARA/L=Grenoble/O=Grenoble INP/OU=SRV/CN=localhost/emailAddress=srv@local"

echo "Signing server cert"
openssl x509 -req \
-days 100 \
-CA certs/ca.crt -CAkey certs/ca.key -CAcreateserial -sha256 \
-in certs/srv.csr \
-out certs/srv.crt \
-extfile srv.ext

echo "Generating cert chain"
cat certs/srv.crt certs/ca.crt > certs/chain.crt
