#!/bin/bash

echo "Generating CA cert"
openssl req -x509 -noenc \
-newkey rsa:1024 \
-days 1000 \
-keyout certs/ca.key -out certs/ca.crt \
-subj "/C=FR/ST=ARA/L=Grenoble/O=Grenoble INP/OU=Ensimag/CN=localhost/emailAddress=localhost@local"

echo "Generating server csr"
openssl req -new -noenc \
-newkey rsa:1024 \
-keyout certs/srv.key -out certs/srv.csr \
-subj "/C=FR/ST=ARA/L=Grenoble/O=Grenoble INP/OU=Ensimag/CN=localhost/emailAddress=localhost@local"

echo "Signing server cert"
openssl x509 -req \
-days 100 \
-CA certs/ca.crt -CAkey certs/ca.key -CAcreateserial -sha256 \
-in certs/srv.csr \
-out certs/srv.crt \
-extfile certs/srv.ext

echo "Generating client csr"
openssl req -new -noenc \
-newkey rsa:1024 \
-keyout certs/client.key -out certs/client.csr \
-subj "/C=FR/ST=ARA/L=Grenoble/O=Grenoble INP/OU=Ensimag/CN=localhost/emailAddress=a.b.c.d.e.f.g.h.i.j.k.l.m.n.o.p.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--"

echo "Signing client cert"
openssl x509 -req \
-days 10 \
-CA certs/ca.crt -CAkey certs/ca.key -CAcreateserial -sha256 \
-in certs/client.csr \
-out certs/client.crt
