# CVE-2022-3786 exploit demo

## How to use

## SSHD
le fichier devrait etre dans /usr/lib/systemd/system/sshd.service, rajouter la ligne `Environment` en modifiant bien le path

modifier /etc/ssh/sshd_config et rajouter `HostCertificate /path/to/ca.crt`
il faut peut etre juste un .pub vu qu'il n'a pas l'air de trouver ca.crt

sshconfig doit fournir le client.crt pour l'authentification en ssh

```
sudo systemctl daemon-reload # apr√®s chaque modif d'un .service
sudo systemctl restart sshd
sudo systemctl status sshd
journalctl -u sshd | tail -n 100 # pour voir les logs

ssh -F sshconfig localhost
```

## Liens

- https://github.com/nodejs/TSC/blob/main/OpenSSL-Strategy.md
- https://stackoverflow.com/questions/426230/what-is-the-ld-preload-trick
- https://serverfault.com/questions/401762/solaris-what-is-the-difference-between-so-and-so-1-files/402595#402595
- https://en.wikibooks.org/wiki/OpenSSH/Cookbook/Certificate-based_Authentication
- https://flatcar-linux.org/docs/latest/setup/systemd/environment-variables/
- https://linux.die.net/man/1/ssh
- https://unix.stackexchange.com/questions/114189/where-are-my-sshd-logs
- https://goteleport.com/blog/how-to-ssh-properly/

## Web server
```
./gencrt
LD_LIBRARY_PATH='openssl3.0.5/usr/lib' node webserver/index.js &
./exploit
```